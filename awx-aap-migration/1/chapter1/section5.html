<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migration of AWX to AAP 2.5 :: Ansible Web eXecutable (AWX) to Ansible Automation Platform 2.5 (AAP) Migration</title>
    <link rel="prev" href="section4.html">
    <link rel="next" href="#section6.adoc">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Ansible Web eXecutable (AWX) to Ansible Automation Platform 2.5 (AAP) Migration</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/awx-aap-migration/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="awx-aap-migration" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Ansible Web eXecutable (AWX) to Ansible Automation Platform 2.5 (AAP) Migration</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">index.adoc</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Migration of AWX to AAP 2.5</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Why did we create this migration course from free to enterprise software?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">What’s the benefit of using Ansible Automation Platform over AWX?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Deployment of AWX</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section4.html">Deployment of the Ansible Automation Platform 2.5 operator</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section5.html">Migration of AWX to AAP 2.5</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#section6.adoc">section6.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ansible Web eXecutable (AWX) to Ansible Automation Platform 2.5 (AAP) Migration</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Ansible Web eXecutable (AWX) to Ansible Automation Platform 2.5 (AAP) Migration</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Ansible Web eXecutable (AWX) to Ansible Automation Platform 2.5 (AAP) Migration</a></li>
    <li><a href="index.html">Migration of AWX to AAP 2.5</a></li>
    <li><a href="section5.html">Migration of AWX to AAP 2.5</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Migration of AWX to AAP 2.5</h1>
<div class="videoblock text-center">
<div class="content">
<video src="_images/awx_aap_migration.mp4" width="700" height="400" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following command to only make the resources available like postgres on the openshift deployed system:</p>
<div class="literalblock">
<div class="content">
<pre>oc apply -f - &lt;&lt; EOF
kind: AnsibleAutomationPlatform
apiVersion: aap.ansible.com/v1alpha1
metadata:
  name: aap
  namespace: awx
spec:
 replicas: 0
EOF</pre>
</div>
</div>
</li>
<li>
<p>To set the current namespace as awx.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc config set-context --current --namespace=awx</pre>
</div>
</div>
</li>
<li>
<p>Export the below variables so that we will be used to create the commands to run the migration:</p>
<div class="literalblock">
<div class="content">
<pre>export AWX_NAMESPACE=awx
export AWX_NAME=awx-demo
export AWX_DB_NAME=$(oc get secret -n $AWX_NAMESPACE $AWX_NAME-postgres-configuration -o jsonpath={.data.database} | base64 -d)
export AWX_DB_HOST=$(oc get secret -n $AWX_NAMESPACE $AWX_NAME-postgres-configuration -o jsonpath={.data.host} | base64 -d)
export AWX_DB_PASSWORD=$(oc get secret -n $AWX_NAMESPACE $AWX_NAME-postgres-configuration -o jsonpath={.data.password} | base64 -d)
export AWX_DB_PORT=$(oc get secret -n $AWX_NAMESPACE $AWX_NAME-postgres-configuration -o jsonpath={.data.port} | base64 -d)
export AWX_DB_USERNAME=$(oc get secret -n $AWX_NAMESPACE $AWX_NAME-postgres-configuration -o jsonpath={.data.username} | base64 -d)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>export AUTOMATION_CONTROLLER_NAME=aap
export AUTOMATION_CONTROLLER_NAMESPACE=awx
export AUTOMATION_CONTROLLER_DB_NAME=$(oc get secret -n $AUTOMATION_CONTROLLER_NAMESPACE $AUTOMATION_CONTROLLER_NAME-controller-postgres-configuration -o jsonpath={.data.database} | base64 -d)
export AUTOMATION_CONTROLLER_DB_PASSWORD=$(oc get secret -n $AUTOMATION_CONTROLLER_NAMESPACE $AUTOMATION_CONTROLLER_NAME-controller-postgres-configuration -o jsonpath={.data.password} | base64 -d)
export AUTOMATION_CONTROLLER_DB_PORT=$(oc get secret -n $AUTOMATION_CONTROLLER_NAMESPACE $AUTOMATION_CONTROLLER_NAME-controller-postgres-configuration -o jsonpath={.data.port} | base64 -d)
export AUTOMATION_CONTROLLER_DB_USERNAME=$(oc get secret -n $AUTOMATION_CONTROLLER_NAMESPACE $AUTOMATION_CONTROLLER_NAME-controller-postgres-configuration -o jsonpath={.data.username} | base64 -d)
export AUTOMATION_CONTROLLER_DB_HOST=$(oc get secret -n $AUTOMATION_CONTROLLER_NAMESPACE $AUTOMATION_CONTROLLER_NAME-controller-postgres-configuration -o jsonpath={.data.host} | base64 -d)</pre>
</div>
</div>
</li>
<li>
<p>Run the following command to enter the AWX postgres database container:</p>
<div class="literalblock">
<div class="content">
<pre>oc exec -it $AWX_NAME-postgres-15-0 -- bash</pre>
</div>
</div>
</li>
<li>
<p>Run the following command inside the Container to migrate the data:</p>
<div class="literalblock">
<div class="content">
<pre>PGPASSWORD=$AWX_DB_PASSWORD pg_dump -h $AWX_DB_HOST -U $AWX_DB_USERNAME -d $AWX_DB_NAME -p $AWX_DB_PORT -F custom  --exclude-table-data 'main_jobevent*' --exclude-table-data 'main_job' | PGPASSWORD=$AUTOMATION_CONTROLLER_DB_PASSWORD pg_restore --clean --if-exists  --no-owner -h $AUTOMATION_CONTROLLER_DB_HOST -U $AUTOMATION_CONTROLLER_DB_USERNAME -d $AUTOMATION_CONTROLLER_DB_NAME -p $AUTOMATION_CONTROLLER_DB_PORT"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Command breakdown:
 Part 1: PGPASSWORD=$AWX_DB_PASSWORD pg_dump ...
•	PGPASSWORD=$AWX_DB_PASSWORD: Temporarily sets the PGPASSWORD environment variable to the password for the AWX database ($AWX_DB_PASSWORD). This allows the pg_dump command to authenticate without prompting for a password.
•	pg_dump: A PostgreSQL utility used to back up a database.
•	-h $AWX_DB_HOST: Specifies the hostname of the AWX database server. $AWX_DB_HOST should be replaced with the actual hostname.
•	-U $AWX_DB_USERNAME: Specifies the username to connect to the AWX database. $AWX_DB_USERNAME should be replaced with the actual database username.
•	-d $AWX_DB_NAME: Specifies the name of the AWX database to be dumped. $AWX_DB_NAME should be replaced with the actual database name.
•	-p $AWX_DB_PORT: Specifies the port on which the AWX database server is listening. $AWX_DB_PORT should be replaced with the actual port number.
•	-F custom: Specifies the output format of the dump. The custom format is a PostgreSQL-specific format that allows for more flexibility during restoration.
  • --exclude-table-data: This option is useful when you need the definition of a particular table even though you do not need the data in it
•	|: The pipe (|) redirects the output of the pg_dump command to the input of the pg_restore command. Essentially, it allows the dump to be directly restored into another database.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Part 2: PGPASSWORD=$AWX_DB_PASSWORD pg_restore ...
•	PGPASSWORD=$AUTOMATION_CONTROLLER_DB_PASSWORD: Again, sets the PGPASSWORD environment variable, but this time for the pg_restore command to authenticate with the target database.
•	pg_restore: A PostgreSQL utility used to restore a database from a backup.
•	--clean: Drops database objects before recreating them. This ensures that the target database is clean and only contains the objects from the backup.
•	--if-exists: Used with --clean, it ensures that objects are only dropped if they exist. This prevents errors if some objects are not present in the target database.
• --no-owner: If this flag isn’t set, then postgres will attribute anything it does to the owner of the original database, when importing and exporting, this could cause issues, so often we will say
•	-h $AUTOMATION_CONTROLLER_DB_HOST: Specifies the hostname of the target Automation Controller database server. $AUTOMATION_CONTROLLER_DB_HOST should be replaced with the actual hostname.
•	-U $AUTOMATION_CONTROLLER_DB_USERNAME: Specifies the username to connect to the target database..
•	-d $AUTOMATION_CONTROLLER_DB_NAME: Specifies the name of the target database (in this case, automationcontroller) into which the backup will be restored.
•	-p $AUTOMATION_CONTROLLER_DB_PORT: Specifies the port on which the target database server is listening. $AUTOMATION_CONTROLLER_DB_PORT should be replaced with the actual port number.</pre>
</div>
</div>
</li>
<li>
<p>To migrate the Organization / Teams and user run the below command on the terminal of aap-gateway-controller pod.</p>
<div class="literalblock">
<div class="content">
<pre># aap-gateway-manage migrate_service_data --username admin --merge-organizations true --api-slug controller -v 3</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Verify the data is migrated.</p>
</div>
<div class="paragraph">
<p>NOTE:
  The above is suggested to be used for local users only. You need to reset the Password for all the users that will get migrated using the above command.
  All Authentication Mechanism needs to be created manually on the Gateway due to centralized Authentication approach for all the softwares of Ansible Automation platform 2.5.</p>
</div>
<nav class="pagination">
  <span class="prev"><a href="section4.html">Deployment of the Ansible Automation Platform 2.5 operator</a></span>
  <span class="next"><a href="#section6.adoc">section6.adoc</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
